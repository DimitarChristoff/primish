<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>primish documentation</title>
	<link href="css/doctor.css" type="text/css" rel="stylesheet">
	
</head>
<body>

<a id="github-ribbon" href="https://github.com/DimitarChristoff/primish.git"><img alt="Fork me on GitHub" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>

<div id="nav">
	<div class="separator"></div>
	<a title="primish documentation" class="brand" href="#" style="background-image:url(images/primish.png)"></a>
	<div class="separator"></div>
	
		<div class="twitter extra">

			<iframe allowtransparency="true" frameborder="0" scrolling="no" style="width: 162px; height: 20px;" src="https://platform.twitter.com/widgets/follow_button.html?screen_name=D_mitar&amp;show_count=false"></iframe>
		</div>
		<div class="separator"></div>
	
	<ul id="sections"><li class="l2"><a href="#changes-from-upstream">Changes from upstream</a><ul><li class="l3"><a href="#changes-from-upstream/prime-changes">prime changes</a></li><li class="l3"><a href="#changes-from-upstream/emitter-changes">emitter changes</a></li><li class="l3"><a href="#changes-from-upstream/options">options</a></li></ul></li><li class="l2"><a href="#creating-a-class">Creating a Class</a><ul><li class="l3"><a href="#creating-a-class/constructor">constructor</a></li><li class="l3"><a href="#creating-a-class/extend">extend</a></li><li class="l3"><a href="#creating-a-class/parent">parent</a></li><li class="l3"><a href="#creating-a-class/mixins">mixins</a></li></ul></li><li class="l2"><a href="#define">Define</a></li><li class="l2"><a href="#plugins">Plugins</a><ul><li class="l3"><a href="#plugins/emitter">emitter</a></li><li class="l3"><a href="#plugins/options">options</a></li></ul></li><li class="l2"><a href="#setup">Setup</a></li></ul>
	<div class="separator"></div>
	
		<div class="extra" id="github">
			<a href="https://github.com/DimitarChristoff/primish.git">Source on Github</a>
		</div>
		<div class="extra" id="github-issues">
			<a href="https://github.com/DimitarChristoff/primish.git/issues">Issues</a>
		</div>
	
	
	<div class="extra generated">
		Generated by <a href="https://github.com/DimitarChristoff/doctor" target="_blank" title="generate documentation from markdown">Doctor, MD</a>
	</div>
</div>
<div id="content" class="container">
	<h1>primish</h1>
<p>A prime derivative that went beyond repair. Initially a fork of <a href="https://github.com/mootools/prime/">MooTools prime</a>, now with a lot of sugar. </p>
<p>You are still advised to use Prime but in case you care, here is what you get with primish:</p>
<h2 id="changes-from-upstream">Changes from upstream</h2>
<h3 id="changes-from-upstream/prime-changes">prime changes</h3>
<ul>
<li><code>.parent()</code></li>
<li><code>.implement()</code> and <code>implement</code> mutator:</li>
<li><code>prime.merge()</code> shallow Object merging</li>
</ul>
<h3 id="changes-from-upstream/emitter-changes">emitter changes</h3>
<ul>
<li>support for event stacking like <code>.on(&#39;foo bar baz&#39;, function(){});</code></li>
<li>support for event pseudos like <code>.on(&#39;foo:once&#39;, function(){});</code></li>
<li><code>emitter.definePseudo()</code> to allow custom pseudo events</li>
</ul>
<h3 id="changes-from-upstream/options">options</h3>
<ul>
<li><code>.setOptions()</code> - shallow merging of object with <code>this.options</code></li>
<li>support for emitter events via <code>onEventname</code> -&gt; <code>this.on(&#39;eventname&#39;)</code> like in MooTools 1.x</li>
</ul>
<p>Use at your own risk, examples in spec. Documentation in /dev/null</p>
<h2 id="creating-a-class">Creating a Class</h2>
<p>To create a new Class, you simply need to do:</p>
<pre class="prettyprint linenums"><code class="lang-ace">require([&#39;prime/prime&#39;], function(prime){

    var Human = prime({
        setName: function(name){
            this.name = name;
        },
        getName: function(){
            return this.name;
        }
    });

    var Bob = new Human();
    Bob.setName(&#39;Bob&#39;);
    console.log(Bob.getName()); // &#39;Bob&#39;

});</code></pre>
<p>You can also add a constructor method on your config object to run automatically:</p>
<pre class="prettyprint linenums"><code class="lang-ace">require([&#39;prime/prime&#39;], function(prime){

    var Human = prime({
        constructor: function(name){
            name &amp;&amp; this.setName(name);
        },
        setName: function(name){
            this.name = name;
        },
        getName: function(){
            return this.name;
        }
    });

    var Bob = new Human(&#39;Bob&#39;);
    console.log(Bob.getName()); // &#39;Bob&#39;

});</code></pre>
<p>Here is an example that will make the name property <code>readonly</code> and  example private variables</p>
<pre class="prettyprint linenums"><code class="lang-ace">require([&#39;prime/prime&#39;], function(prime){

    var Human = (function(){
        var storage = {},
            hid = 0;

        var Human = prime({
            constructor: function(name){
                this.$hid = hid++;
                storage[this.$hid] = {};
                // disallow changes to human id
                prime.define(this, &#39;$hid&#39;, {
                    writable: false,
                    enumerable: false
                });

                prime.define(this, &#39;name&#39;, {
                    configurable: false,
                    get: function(){
                        return this.getName();
                    }
                });

                name &amp;&amp; this.setName(name);
            },
            setName: function(name){
                storage[this.$hid].name = name;
            },
            getName: function(){
                return storage[this.$hid].name;
            }
        });

        return Human;
    }());

    var Bob = new Human(&#39;Bob&#39;),
        Greg = new Human(&#39;Greg&#39;);

    console.log(Bob);
    console.log(Bob.getName()); // &#39;Bob&#39;
    console.log(Bob.name); // &#39;Bob&#39;
    Bob.name = &#39;Robert&#39;; // nope, should not change.
    console.log(Bob.name); // &#39;Bob&#39;
    Bob.$uid = Greg.$uid; // try to puncture Greg&#39;s storage
    console.log(Bob.name); // &#39;Bob&#39;

});</code></pre>
<p>What happens behind the scenes? <code>prime</code> accepts a single argument as a config object. The object is a simple JavaScript
Object - with special keys (also referred to <code>mutator keys</code>).</p>
<p>A <code>mutator key</code> is a key:value pair that has a special meaning and is used differently by the Class constructor. The
following keys in your config object are considered <code>mutator</code>:</p>
<h3 id="creating-a-class/constructor">constructor</h3>
<p>The <code>constructor</code> method in your config object is what becomes the prime constructor. It runs automatically when you
instantiate and can accept any number of arguments, named or otherwise.</p>
<pre class="prettyprint linenums"><code class="lang-ace">require([&#39;prime/prime&#39;], function(prime){
    // have an element
    var div = document.createElement(&#39;div&#39;);
    div.setAttribute(&#39;id&#39;, &#39;myWidget&#39;);
    document.body.appendChild(div);

    var Widget = prime({
        options: {
            title: &#39;My Widget&#39;
        },
        constructor: function(el, options){
            this.element = document.getElementById(el);
            if (options &amp;&amp; Object(options) === options){
                this.options = options;
            }
            this.element.innerHTML = this.options.title;
        }
    });

    var instance = new Widget(&#39;myWidget&#39;, {
        title: &#39;Cool Widget&#39;,
        height: 300
    });

    console.log(instance.options.title); // &#39;Cool Widget&#39;
    console.log(instance.element.innerHTML); // &#39;Cool Widget&#39;
});</code></pre>
<h3 id="creating-a-class/extend">extend</h3>
<p>The special key <code>extend</code> defines what SuperClass your new Class will inherit from. It only accepts a single argument,
pointing to another Class. The resulting new Class definition will have its prototype set to the SuperClass and inherit
any of its static properties and methods via the scope chain.</p>
<p>This allows you to abstract differences between Classes without having to repeat a lot of code.</p>
<pre class="prettyprint linenums"><code class="lang-ace">require([&#39;prime/prime&#39;], function(prime){
    var Rectangle = prime({

        constructor: function(width, height){
            return this.setwidth(width).setHeight(height);
        },

        setWidth: function(width){
            this.width = width;
            return this; // allow chaining
        },

        setHeight: function(height){
            this.height = height;
            return this;
        },

        squareRoot: function(){
            return this.height * this.width;
        }

    });

    var Square = prime({

        // subclass of Rectangle
        extend: Rectangle,

        constructor: function(side){
            return this.setSide(side);
        },

        setSide: function(side){
            // both sides are the same
            this.width = this.height = side;
            return this;
        },

        setWidth: function(width){
            return this.setSide(width);
        },

        setHeight: function(height){
            return this.setSide(height);
        }

    });

    var square = new Square(30);
    square.setWidth(5); // local
    console.log(square.height); // 5
    console.log(square.squareRoot()); // from parent proto of Rectangle, 25
});</code></pre>
<p>Changes to the parent Class are also reflected in the child Class by inheritance (unless the child has a local
implementation). This differs from when you use the <a href="#mixin">mixin</a> directives, which copies instead.</p>
<pre class="prettyprint linenums"><code class="lang-javascript">// continued from above
Rectangle.prototype.shrink = function(){
    this.width--;
    this.height--;
    return this;
};

// square can also now call .shrink:
square.setSide(5).shrink();
square.width; // 4;
square.height; // 4</code></pre>
<h3 id="creating-a-class/parent">parent</h3>
<p>When <a href="#extend">extending a Class</a>, you can access methods from the super via the <code>.parent()</code> method. It expects at least
1 argument - the method name as <code>String</code>. This is synthactic sugar for saying:</p>
<p> <code>this.constructor.prototype.methodname.apply(this, [arguments])</code>, where methodname is the method passed as string.</p>
<p>Here is a more comprehensive example:</p>
<pre class="prettyprint linenums"><code class="lang-ace">require([&#39;prime/prime&#39;], function(prime){
    // this example won&#39;t work w/o jQuery and ECMA5
    // assume this.$element is a jquery wrapped el.

    var Widget = prime({

        attachEvents: function(){
            this.$element.on(&#39;click&#39;, this.handleclick.bind(this));
        },
        handleClick: function(){

        },
        setTitle: function(title){
            this.$element.find(&#39;.title&#39;).text(title);
        }

    });

    var WeatherWidget = prime({

        extend: Widget,

        attachEvents: function(){
            this.parent(&#39;attachEvents&#39;); // call it on super Widget
            // do more.
            this.$element.find(&#39;input&#39;).on(&#39;blur&#39;, this.validateInput.bind(this));
        },
        validateInput: function(event){

        }

    });

    // example with shifting arguments
    var NewsWidget = prime({

        extend: Widget,

        setTitle: function(text){
            this.$element.find(&#39;.sub-heading&#39;).addClass(&#39;active&#39;);
            this.parent(&#39;setTitle&#39;, text); // passes original arg to parent.
        }

    });
});</code></pre>
<h3 id="creating-a-class/mixins">mixins</h3>
<p>The special key <code>implement</code> is used to tell prime which other Objects&#39; properties are to be <code>copied</code> into your own Class
definition. Mixins do not work via inheritance, they create a local instance of the properties.</p>
<p>When used as a property, <code>implement</code> accepts either a single Class or an array of Classes to implement.</p>
<pre class="prettyprint linenums"><code class="lang-ace">require([&#39;prime/prime&#39;], function(prime){
    // example using a small event emitter as a mixin
    var EID = 0;

    var Emitter = prime({

        on: function(event, fn){
            var listeners = this._listeners || (this._listeners = {}),
                events = listeners[event] || (listeners[event] = {});

                for (var k in events) if (events[k] === fn) return this;

                events[(EID++).toString(36)] = fn;
            return this;
        },

        trigger: function(event){
            var listeners = this._listeners, events, k, args;
            if (listeners &amp;&amp; (events = listeners[event])){
                args = (arguments.length &gt; 1) ? slice.call(arguments, 1) : [];
                for (k in events) events[k].apply(this, args);
            }
            return this;
        }

    });

    var myClass = prime({

        // implement the emitter:
        implement: [Emitter],

        doSomethingImportant: function(){
            this.trigger(&#39;important&#39;);
        }

    });

    var instance = new myClass();

    // bind some event, .on is available
    instance.on(&#39;important&#39;, function(){
        console.log(&#39;important is done&#39;);
    });

    // call the method that will fire the event.
    instance.doSomethingImportant();
});</code></pre>
<p>There is an alternative syntax to allow <code>late implementation</code> via the <code>.mixin</code> method:</p>
<pre class="prettyprint linenums"><code class="lang-javascript">myClass.implement(new OtherClass());
// or chaining on an instance
instanceofMyClass.implement(new OtherClass2()).mixin(new OtherClass3());

// late binding at proto definition also works
var myClass = prime({}).mimplement(new OtherClass);</code></pre>
<p><div class="alert">Note: When a mixin is implemented, the mixin Class is instantiated (via <code>new</code>) and the methods are copied from
the instance, not the prototype. Changing the mixin prototype afterwards will not automatically make the changes available
in your Class instances (unlike when using <a href="#extend">extend</a>)</div></p>
<h2 id="define">Define</h2>
<p>Define is a micro polyfill to <code>Object.defineProperty</code> - see <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/defineProperty">MDN</a>. It works in conjunction with <code>Object.getOwnPropertyDescriptor</code>, which is also shimmed for older browsers.</p>
<p>This allows you to have read-only properties of objects, or private getters/setters. Example use</p>
<pre class="prettyprint linenums"><code class="lang-ace">require([&#39;prime/prime&#39;], function(prime){
    var Human = prime({

        constructor: function(name){
            this.name = name;

            // make name readonly
            prime.define(this, &#39;name&#39;, {
                writable: false,
                enumerable: true
            });
        },

        setName: function(name){
            this.name = name; // won&#39;t work in modern browsers
        }

    });

    var Bob = new Human(&#39;Bob&#39;);

    Bob.setName(&#39;Robert&#39;);

    Bob.name = &#39;Rob&#39;;

    // should be fine.
    console.info(Bob.name);
    console.assert(Bob.name === &#39;Bob&#39;);

});</code></pre>
<h2 id="plugins">Plugins</h2>
<h3 id="plugins/emitter">emitter</h3>
<p>The Emitter class can work either as a <a href="#mixins">mixin</a> or as a standalone Class instance. It provides any Class that uses it with 3 methods it can call:</p>
<ul>
<li><code>.on(event, callback)</code> - subscribes to <code>String(event)</code> and runs <code>callback</code> when fired.</li>
<li><code>.off(event, callback)</code> - removes specific subscription to <code>String(event)</code> by exact reference to <code>callback</code>. Removing events requires you to be able to pass on the original bound callback.</li>
<li><code>.trigger(event, [Optional arguments])</code> - fires <code>String(event)</code> and optionally passes arguments to the callback</li>
</ul>
<p>By default, the scope of <code>this</code> in any event callback function will be the object that fired it, not the subscriber. If you want to keep scope bound to your local instance, you need to use <code>Function.prototype.bind</code> (if ES5Shim is being used) or <code>_.bind</code> (lodash or underscore), which is probably safer.</p>
<h4>Using events</h4>
<pre class="prettyprint linenums"><code class="lang-ace">require([&#39;prime/prime&#39;, &#39;prime/emitter&#39;], function(prime, emitter){
    // this example won&#39;t run w/o ECMA5 Function.prototype.bind

    var someController = new (prime({
        implement: [emitter]
    }))();

    var Human = prime({
        implement: [Emitter],
        constructor: function(){
            this.attachEvents();
        },
        eat: function(energy){
            this.energy += energy;
            // fire an event, passing how much and new energy level
            this.trigger(&#39;eat&#39;, [energy, this.energy]);
        },
        attachEvents: function(){
            // subscribe to another instance&#39;s init event
            someController.on(&#39;init&#39;, this.initialize.bind(this));

            // example of an event that gets removed after a single run
            this.boundFetch = this.dataFetched.bind(this);
            someController.on(&#39;fetch&#39;, this.boundFetch);
        },
        initialize: function(){
            // this will only run after the controller fires init, this = self.
            console.log(&#39;ready to do stuff&#39;);
        },
        dataFetched: function(){
            // should only run once and unsubscribe
            // do stuff
            console.log(&#39;we have data&#39;);

            // remove the event by passing reference to the saved bound function
            this.off(&#39;fetch&#39;, this.boundFetch);
            delete this.boundFetch;
        }
    });

    var Bob = new Human();
    someController.trigger(&#39;init&#39;);
    setTimeout(function(){
        someController.trigger(&#39;fetch&#39;);
    }, 1000);
});</code></pre>
<p>You can also use <strong>named anonymous functions</strong> to remove your own event in a hurry:</p>
<pre class="prettyprint linenums"><code class="lang-ace">require([&#39;prime/prime&#39;, &#39;prime/emitter&#39;], function(prime, emitter){
    var Human = prime({
        implement: [emitter],
        constructor: function(){
            this.on(&#39;hi&#39;, function hiEvent(){
                console.log(&#39;running callback&#39;);
                this.off(&#39;hi&#39;, hiEvent);
            });
        }
    });

    var h = new Human();
    h.trigger(&#39;hi&#39;).trigger(&#39;hi&#39;); // should only console.log once

    // or simply use the :once pseudo
    h.on(&#39;bye:once&#39;, function(){
        console.log(&#39;bye&#39;);
    });

    h.trigger(&#39;bye&#39;);
    h.trigger(&#39;bye&#39;); // won&#39;t do anything
});</code></pre>
<p>There is also syntactic sugar available for adding more than one event to the same callback:</p>
<pre class="prettyprint linenums"><code class="lang-javascript">var cb = function(){
};

model.on(&#39;change fetch create&#39;, cb); // any of change, fetch or create events fire the same handler</code></pre>
<h4>definePseudo</h4>
<p>Emitter supports <code>pseudo events</code>, similar in style to CSS pseudos. For instance: <code>load:once</code> is a <code>load</code> event with a <code>once</code> pseudo.</p>
<p>By default, emitter ships with <code>once</code> pre-defined - which will run an event callback once only, then unbind itself.</p>
<p>It exposes an API to define custom pseudos on the emitter object.</p>
<pre class="prettyprint linenums"><code class="lang-ace">require([&#39;prime/prime&#39;, &#39;prime/emitter&#39;], function(prime, emitter){

    var user = {
        role: &#39;tester&#39;
    };

    // definePseudo takes 2 arguments - base event name and fn callback
    emitter.definePseudo(&#39;admin&#39;, function(eventName, fn){
        // need to return a function
        return function(){
            // eg, check if user.role is admin
            if (user.role === &#39;admin&#39;){
                fn.apply(this, arguments);
            }
        };
    });

    var e = new emitter();

    e.on(&#39;load:once&#39;, function(){
        console.log(&#39;loaded, should see this once&#39;);
    });

    e.on(&#39;test:admin&#39;, function(){
        console.log(&#39;this should only run when user.role === &quot;admin&quot;&#39;);
    });

    // once
    e.trigger(&#39;load&#39;);
    e.trigger(&#39;load&#39;);

    // at the moment, role is wrong, so this won&#39;t fire
    e.trigger(&#39;test&#39;);

    user.role = &#39;admin&#39;;
    e.trigger(&#39;test&#39;); // test:admin cb will now run
});</code></pre>
<h3 id="plugins/options">options</h3>
<p>A small utility mixin from Arian&#39;s prime-util that allows easy object merge of an Object into <code>this.object</code> from right to left. If emitter is also mixed-in, it will automatically add events prefixed by <code>on</code> and camelcased, eg, <code>onReady: function(){}</code>.</p>
<pre class="prettyprint linenums"><code class="lang-ace">require([&#39;prime/prime&#39;, &#39;prime/emitter&#39;, &#39;prime/options&#39;], function(prime, emitter, options){
    var Human = prime({
        options: {
            name: &#39;unknown&#39;
        },
        implement: [options, emitter],
        constructor: function(options){
            this.setOptions(options);
            this.trigger(&#39;ready&#39;);
        }
    });

    var bob = new Human({
        name: &#39;Bob&#39;,
        surname: &#39;Roberts&#39;,
        onReady: function(){
            console.log(this.options.name, this.options.surname);
            // this.options.onReady won&#39;t be added.
        }
    });
});</code></pre>
<h2 id="setup">Setup</h2>
<pre><code class="lang-sh"># pull the deps
$ npm install

# run the tests
$ npm test

# generate docs
$ npm install -g grunt-cli
$ grunt
$ cd dist
$ python -m SimpleHTTPServer
# go to http://localhost:8000</code></pre>

	
</div>
<script src="js/mootools-yui-compressed.js"></script>
<script src="js/moostrap-scrollspy.js"></script>
<script src="js/prettify.js"></script>
<script src="js/lang-css.js"></script>
<script src="js/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="js/doctor.js"></script>
	
</body>
</html>